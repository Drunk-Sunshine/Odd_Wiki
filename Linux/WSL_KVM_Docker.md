# Windows下运行Linux的方案

### 1. 虚拟机 (Virtual Machine)

#### 技术区别
- 通过Hypervisor（如VMware、VirtualBox等）创建一个完整的虚拟计算机。
- 模拟硬件环境，运行完整的操作系统。

#### 优点
- 可以运行多个操作系统，适合测试和开发多种环境。
- 提供完整的隔离性，适合运行不兼容的应用程序。
- 支持图形界面应用程序。

#### 缺点
- 启动时间较长，通常需要几分钟。
- 资源占用高，需要分配虚拟硬件和完整的操作系统。
- 性能相对较低，可能会导致额外的延迟。

### 2. 双系统 (Dual Boot)

#### 技术区别
- 在同一台计算机上安装两个或多个操作系统，用户在启动时选择要加载的系统。
- 每个操作系统独立运行，互不干扰。

#### 优点
- 性能最佳，因为每个操作系统都直接访问硬件资源。
- 适合需要完整操作系统功能的应用程序。
- 可以充分利用系统资源。

#### 缺点
- 启动时间较长，用户需要重启计算机切换系统。
- 磁盘空间占用较大，需要为每个操作系统分配独立的分区。
- 更新和维护多个操作系统较为复杂。

### 3. WSL (Windows Subsystem for Linux)

#### 技术区别
- Windows内置的功能，允许用户直接在Windows内核上运行Linux二进制文件。
- WSL 2使用轻量级虚拟化技术，但仍与Windows紧密集成。

#### 优点
- 启动时间快，通常在几秒钟内。
- 资源占用较少，适合开发和测试环境。
- 与Windows应用程序无缝集成，方便开发工作。

#### 缺点
- 对某些图形应用程序支持有限。
- 不支持完整的Linux桌面环境。
- 某些系统调用可能不完全兼容。

### 总结
- **虚拟机**：适合需要完整操作系统和图形界面的应用程序，但资源占用高。
- **双系统**：性能最佳，适合需要完整功能的应用程序，但切换不便。
- **WSL**：适合开发环境，启动快且资源占用少，但对图形应用支持有限。

> 性能上：双系统>虚拟机>WSL
>
> 速度上：WSL>虚拟机>双系统

### 4.补充Docker—应用层解决方案

虚拟机是在**物理资源层面实现的隔离**，相对于虚拟机，Docker 是你 **APP 层面实现的隔离**，并且省去了虚拟机操作系统（Guest OS），从而节省了一部分的系统资源；Docker 守护进程可以直接与主操作系统进行通信，为各个 Docker 容器分配资源；它还可以将容器与主操作系统隔离，并将各个容器互相隔离。虚拟机启动需要数分钟，而 Docker 容器可以在数毫秒内启动。由于没有臃肿的从操作系统，Docker 可以节省大量的磁盘空间以及其他系统资源。

![image](https://img2023.cnblogs.com/blog/1344595/202306/1344595-20230605210306301-1297212116.png)

#### 组成

Docker提供了一个注册服务器（Registry）来保存多个仓库，每个仓库可以包含多个具备不同tag的镜像。

- 镜像：Docker的镜像是由多个层（layers）组成的，每一层都是对前一层的增量更新；基础镜像类似虚拟机镜像，如Ubuntu 18.04等，属于只读文件

- 容器：类似Linux系统环境，是一个被创建的用于运行的实例，docker会在镜像的最上一层创建一个可写层

- 仓库：用于存放一类镜像，常见的Docker仓库有Docker Hub、Harbor等

  ![img](https://images2018.cnblogs.com/blog/1387124/201808/1387124-20180808221433322-1112148386.png)

  ![img](https://images2018.cnblogs.com/blog/1387124/201808/1387124-20180808221433616-1309217661.png)

#### 具体对比

虚拟机的Guest OS层和Hypervisor层在Docker中被Docker Engine层所替代。虚拟机的Guest OS，即为虚拟机安装的操作系统，是一个完整的操作系统内核；虚拟机的Hypervisor层是一个硬件虚拟化平台。

- **虚拟机资源隔离方法**：

  - 利用独立的OS，并用Hypervisor虚拟化CPU、内存、I/O设备等。
  - Hypervisor为每个虚拟CPU创建数据结构，模拟CPU寄存器的值。
  - 使用shadow page table进行内存虚拟化。
  - 当Hypervisor接收到I/O请求时，通过软件模拟设备并返回结果。

- **Docker资源隔离方法**：

  - Docker利用Linux内核本身支持的容器方式实现资源和环境隔离。
  - 利用namespace实现系统环境的隔离。
  - 利用Cgroup实现资源限制。
  - 利用镜像实现根目录环境的隔离。

- **计算效率比较：**

  在IBM x3650 M4服务器上进行的Linpack程序测试显示：

  - Docker的计算能力几乎没有损耗，而虚拟机的计算能力损耗约为50%。
  - 性能损耗的原因包括虚拟机增加了一层虚拟硬件层和虚拟CPU架构与实际CPU架构不匹配

- **内存访问比较：**

  - **连续地址块的内存读写**：Docker与虚拟机的性能差异不大，主要受物理内存速度限制。
  - **随机内存访问**：Docker的性能明显优于虚拟机，但在多CPU访问时性能差距不明显，由于内存访问控制复杂导致的性能损失。

#### 劣势

1. 资源隔离不如虚拟机，Cgroup仅限制资源最大值。
2. 安全性问题，无法区分具体执行指令的用户。
3. 版本更新快速，存在兼容性问题。

> 参考文献：Felter W, Ferreira A, Rajamony R, et al. An Updated Performance Comparison of Virtual Machines and Linux Containers. Technology, 2014, 28: 32.
>
> 参考链接：(https://www.cnblogs.com/werr370/p/17458939.html)
> (https://blog.csdn.net/cbl709/article/details/43955687)

